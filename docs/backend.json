
{
  "entities": {
    "Company": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Company",
      "type": "object",
      "description": "Represents a company with its details.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Company entity." },
        "name": { "type": "string", "description": "Name of the company." },
        "contactPerson": { "type": "string" },
        "email": { "type": "string", "format": "email"},
        "mobile": { "type": "string" },
        "address": { "type": "string", "description": "Address of the company." },
        "logoUrl": { "type": "string", "format": "uri", "description": "URL of the company logo." },
        "description": { "type": "string" },
        "directorIds": { "type": "array", "items": { "type": "string" }, "description": "A list of user IDs for the directors of the company." },
        "pmIds": { "type": "array", "items": { "type": "string" }, "description": "A list of user IDs for the Project Managers of the company." },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["name", "createdAt"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user's core profile and their organizational membership.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "position": { "type": "string", "enum": ["Admin", "CEO", "Director", "PM", "CM", "Engineer", "General Foreman", "Safety Officer", "Safety Manager", "Logistic", "Document Controller", "Accountant", "progress_control"] },
        "companyId": { "type": "string" },
        "salaryNumber": { "type": "string", "description": "Unique Salary Number or Series Number for the employee within a company." },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["name", "email", "position", "companyId", "createdAt"]
    },
    "UserProjectMembership": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Project Membership",
      "type": "object",
      "description": "A record showing that a user is a member of a specific project. Stored in a subcollection under the user.",
      "properties": {
        "role": { "type": "string" },
        "companyId": { "type": "string" },
        "projectName": { "type": "string", "description": "Denormalized project name for fast display." },
        "projectStatus": { "type": "string", "enum": ["active", "closed"], "description": "Denormalized project status." },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["role", "companyId", "projectName"]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a construction project.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "name": { "type": "string" },
        "directorId": { "type": "string" },
        "pmId": { "type": "string" },
        "pmName": { "type": "string", "description": "Denormalized project manager name for fast display."},
        "status": { "type": "string", "enum": ["active", "closed"] },
        "totalWork": { "type": "number" },
        "doneWork": { "type": "number" },
        "approvedWork": { "type": "number" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "archived": { "type": "boolean" },
        "address": { "type": "string" },
        "googleMapsUrl": { "type": "string", "format": "uri" },
        "kmlUrl": { "type": "string", "format": "uri" }
      },
      "required": ["companyId", "name", "directorId", "pmId", "status", "createdAt"]
    },
    "ProjectMember": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Project Member",
        "type": "object",
        "description": "A record showing a user's role on a project. Stored in a subcollection under the project.",
        "properties": {
            "role": { "type": "string", "enum": ["director", "pm", "cm", "engineer", "foreman", "safety", "logistics", "doc_controller", "accounting"] },
            "companyId": { "type": "string" },
            "userName": { "type": "string", "description": "Denormalized user name for fast display." },
            "position": { "type": "string", "description": "Denormalized user position." },
            "createdAt": { "type": "string", "format": "date-time" },
            "updatedAt": { "type": "string", "format": "date-time" }
        },
        "required": ["role", "companyId", "userName", "position"]
    },
    "Equipment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Equipment",
      "type": "object",
      "description": "A denormalized equipment document for fast reads.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "projectId": { "type": "string" },
        "projectName": { "type": "string", "description": "Denormalized for listing." },
        "equipmentNameId": { "type": "string" },
        "equipmentName": { "type": "string", "description": "Denormalized for listing." },
        "plateNumber": { "type": "string" },
        "pmId": { "type": "string" },
        "pmName": { "type": "string", "description": "Denormalized for listing." },
        "assigneeId": { "type": "string" },
        "assigneeName": { "type": "string", "description": "Denormalized for listing." },
        "situation": { "type": "string", "enum": ["Working at site", "Broke down at site", "In garage"] },
        "remarks": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "ownershipType": { "type": "string", "enum": ["Company", "Rent"] },
        "ownerCompanyId": { "type": "string", "description": "ID of the company that owns this equipment, if not rented." },
        "rentalOwnerCompany": { "type": "string" },
        "rentalContactPerson": { "type": "string" },
        "rentalMobile": { "type": "string" },
        "rentalPhone": { "type": "string" },
        "rentalMonthlyRent": { "type": "number" },
        "rentalAnnualRent": { "type": "number" },
        "rentalStartDate": { "type": "string", "format": "date-time" }
      },
      "required": ["companyId", "projectId", "equipmentNameId", "plateNumber", "pmId", "assigneeId", "situation", "ownershipType"]
    },
     "EquipmentLog": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Equipment Log",
        "type": "object",
        "description": "An audit log entry for a change to an equipment record.",
        "properties": {
            "id": { "type": "string" },
            "timestamp": { "type": "string", "format": "date-time" },
            "userId": { "type": "string" },
            "userName": { "type": "string" },
            "eventType": { "type": "string", "enum": ["Status Change", "Assignment Change", "Breakdown", "Repair"] },
            "details": { "type": "object" }
        },
        "required": ["timestamp", "userId", "userName", "eventType", "details"]
    },
    "EquipmentName": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Equipment Name", "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" } }, "required": ["name"]
    },
    "Unit": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Unit", "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" } }, "required": ["name"]
    },
    "Zone": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Zone", "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "mapSvg": { "type": "string" } }, "required": ["name"]
    },
    "Activity": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Activity", "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "code": { "type": "string" }, "description": { "type": "string" }, "totalWork": { "type": "number" }, "doneWork": { "type": "number" }, "approvedWork": { "type": "number" }, "pendingWork": { "type": "number" }, "workGradeA": { "type": "number" }, "workGradeB": { "type": "number" }, "workGradeC": { "type": "number" }, "plannedQuantity": { "type": "number" }, "plannedStartDate": { "type": "string", "format": "date-time" }, "plannedEndDate": { "type": "string", "format": "date-time" } }, "required": ["name", "code", "description"]
    },
    "SubActivity": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "SubActivity", "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "description": { "type": "string" }, "unit": { "type": "string" }, "totalWork": { "type": "number" }, "doneWork": { "type": "number" }, "approvedWork": { "type": "number" }, "pendingWork": { "type": "number" }, "workGradeA": { "type": "number" }, "workGradeB": { "type": "number" }, "workGradeC": { "type": "number" }, "plannedQuantity": { "type": "number" }, "plannedStartDate": { "type": "string", "format": "date-time" }, "plannedEndDate": { "type": "string", "format": "date-time" }, "progressByZone": { "type": "object", "description": "A map tracking work quantities for each zone." } }, "required": ["name", "description", "unit", "totalWork"]
    },
    "SubActivityZoneQuantity": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "SubActivityZoneQuantity", "type": "object", "properties": { "zoneId": { "type": "string" }, "quantity": { "type": "number" } }, "required": ["zoneId", "quantity"]
    },
    "ProgressReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Progress Report", "type": "object",
      "description": "Source of truth for a single progress submission. DEPRECATED in favor of DailyReport.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "projectId": { "type": "string" },
        "activityId": { "type": "string" },
        "subActivityId": { "type": "string" },
        "zoneId": { "type": "string" },
        "engineerId": { "type": "string" },
        "cmId": { "type": "string" },
        "quantity": { "type": "number" },
        "date": { "type": "string", "format": "date-time", "description": "Actual work date." },
        "diaryDate": { "type": "string", "description": "YYYYMMDD format for indexing." },
        "remarks": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["Pending", "A", "B", "C"], "description": "A=Approved, B=Approved w/ Remarks, C=Rejected" },
        "inspectionStatus": { "type": "string", "enum": ["Pending", "Complete"] },
        "gradeAQuantity": { "type": "number" },
        "gradeBQuantity": { "type": "number" },
        "gradeCQuantity": { "type": "number" },
        "inspectionDate": { "type": "string", "format": "date-time" },
        "inspectorRemarks": { "type": "string" },
        "wirUserId": { "type": "string" },
        "generalForeman": { "type": "string"},
        "foreman": { "type": "string"},
        "road": { "type": "string"},
        "subcontractor": { "type": "string"}
      },
      "required": ["companyId", "projectId", "activityId", "subActivityId", "zoneId", "engineerId", "cmId", "quantity", "date", "diaryDate", "status"]
    },
     "DailyReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Daily Report",
      "type": "object",
      "description": "A container for a single day's progress report, submitted by an engineer.",
      "properties": {
        "id": { "type": "string" },
        "projectId": { "type": "string" },
        "companyId": { "type": "string" },
        "engineerId": { "type": "string" },
        "engineerName": { "type": "string", "description": "Denormalized engineer name for fast display." },
        "pmId": { "type": "string" },
        "cmId": { "type": "string" },
        "reportDate": { "type": "string", "format": "date-time", "description": "The date the work was performed." },
        "diaryDate": { "type": "string", "description": "The report date in YYYYMMDD format for indexing." },
        "createdAt": { "type": "string", "format": "date-time", "description": "The submission timestamp." },
        "status": { "type": "string", "enum": ["Pending", "Approved"] },
        "totalQuantity": { "type": "number", "description": "Sum of all item quantities in this report." }
      },
      "required": ["projectId", "companyId", "engineerId", "pmId", "cmId", "reportDate", "diaryDate", "createdAt", "status"]
    },
    "ReportItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report Item",
      "type": "object",
      "description": "A single line item within a Daily Report.",
      "properties": {
        "id": { "type": "string" },
        "activityId": { "type": "string" },
        "subActivityId": { "type": "string" },
        "zoneId": { "type": "string" },
        "quantity": { "type": "number" },
        "remarks": { "type": "string" },
        "generalForeman": { "type": "string"},
        "foreman": { "type": "string"},
        "road": { "type": "string"},
        "subcontractor": { "type": "string"}
      },
      "required": ["activityId", "subActivityId", "zoneId", "quantity"]
    },
    "ReportIndex": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Report Index", "type": "object",
        "description": "A denormalized, global index for quickly listing progress reports.",
        "properties": {
            "id": { "type": "string" }, "companyId": { "type": "string" }, "projectId": { "type": "string" }, "projectName": { "type": "string" }, "activityName": { "type": "string" }, "subActivityName": { "type": "string" }, "zoneName": { "type": "string" }, "engineerName": { "type": "string" }, "cmName": { "type": "string" }, "quantity": { "type": "number" }, "date": { "type": "string", "format": "date-time" }, "createdAt": { "type": "string", "format": "date-time" }, "sourcePath": { "type": "string", "description": "Path to the original report document." }
        },
        "required": ["companyId", "projectId", "projectName", "date", "createdAt", "sourcePath"]
    },
    "AdminDashboardSummary": {
        "$schema": "http://json-schema.org/draft-07/schema#", "title": "Admin Dashboard Summary", "type": "object", "properties": { "companiesCount": { "type": "number" }, "projectsActiveCount": { "type": "number" }, "equipmentActiveCount": { "type": "number" }, "updatedAt": { "type": "string", "format": "date-time" } }
    },
    "CompanyDashboardSummary": {
        "$schema": "http://json-schema.org/draft-07/schema#", "title": "Company Dashboard Summary", "type": "object", "properties": { "activeProjects": { "type": "number" }, "totalEquipment": { "type": "number" }, "equipmentWorking": { "type": "number" }, "equipmentBroken": { "type": "number" }, "equipmentGarage": { "type": "number" }, "updatedAt": { "type": "string", "format": "date-time" } }
    },
    "ProjectDashboardSummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project Dashboard Summary",
      "type": "object",
      "description": "A high-level rollup document for overall project progress, tracking the average completion across all sub-activities.",
      "properties": {
        "subActivityCount": { "type": "number" },
        "totalProgressSum": { "type": "number", "description": "The sum of all individual sub-activity completion percentages. E.g., 50% + 10% = 60.0" },
        "overallProgress": { "type": "number", "description": "The true average progress: totalProgressSum / subActivityCount." },
        "lastReportAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      }
    },
     "SubActivitySummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sub-Activity Summary",
      "type": "object",
      "description": "A detailed, real-time summary of a single sub-activity's progress.",
      "properties": {
        "totalWork": { "type": "number" },
        "doneWork": { "type": "number" },
        "pendingWork": { "type": "number" },
        "workGradeA": { "type": "number" },
        "workGradeB": { "type": "number" },
        "workGradeC": { "type": "number" },
        "unit": { "type": "string" },
        "activityName": { "type": "string" },
        "subActivityName": { "type": "string" },
        "BoQ": { "type": "string" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["totalWork", "doneWork", "pendingWork", "unit", "activityName", "subActivityName", "BoQ"]
    },
     "Invitation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invitation", "type": "object", "description": "Represents an invitation for a new user to sign up.",
      "properties": {
        "id": { "type": "string" }, "code": { "type": "string" }, "email": { "type": "string", "format": "email" }, "name": { "type": "string" }, "position": { "type": "string" }, "companyId": { "type": "string" }, "status": { "type": "string", "enum": ["pending", "completed"] }, "createdAt": { "type": "string", "format": "date-time" }, "creatorId": { "type": "string" }, "creatorName": { "type": "string" }, "completedAt": { "type": "string", "format": "date-time" }, "usedBy": { "type": "string" }, "salaryNumber": { "type": "string", "description": "Unique Salary Number or Series Number for the employee within a company." }
      },
      "required": ["code", "email", "name", "position", "companyId", "status", "createdAt", "creatorId", "creatorName"]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a document submitted for approval.",
      "properties": {
        "id": { "type": "string" },
        "projectId": { "type": "string" },
        "creatorId": { "type": "string" },
        "pmId": { "type": "string" },
        "type": { "type": "string", "enum": ["Permit", "Document", "Payment"] },
        "status": { "type": "string", "enum": ["Pending", "Under Review", "Approved"] },
        "documentDate": { "type": "string", "format": "date-time" },
        "remarks": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "pmApprovedAt": { "type": "string", "format": "date-time" },
        "pmApproverId": { "type": "string" },
        "adminApprovedAt": { "type": "string", "format": "date-time" },
        "adminApproverId": { "type": "string" }
      },
      "required": ["projectId", "creatorId", "pmId", "type", "status", "documentDate", "createdAt"]
    }
  },
  "auth": { "providers": ["password", "anonymous"] },
  "firestore": {
    "/companies/{companyId}": { "schema": { "$ref": "#/entities/Company" } },
    "/users/{userId}": { "schema": { "$ref": "#/entities/User" } },
    "/users/{userId}/project_memberships/{projectId}": { "schema": { "$ref": "#/entities/UserProjectMembership" } },
    "/projects/{projectId}": { "schema": { "$ref": "#/entities/Project" } },
    "/projects/{projectId}/members/{userId}": { "schema": { "$ref": "#/entities/ProjectMember" } },
    "/projects/{projectId}/dashboards/summary": { "schema": { "$ref": "#/entities/ProjectDashboardSummary" } },
    "/projects/{projectId}/dashboards/{subActivityId}": { "schema": { "$ref": "#/entities/SubActivitySummary" } },
    "/equipment/{equipmentId}": { "schema": { "$ref": "#/entities/Equipment" } },
    "/equipment/{equipmentId}/logs/{logId}": { "schema": { "$ref": "#/entities/EquipmentLog" } },
    "/equipment_names/{equipmentNameId}": { "schema": { "$ref": "#/entities/EquipmentName" } },
    "/invitations/{invitationId}": { "schema": { "$ref": "#/entities/Invitation" } },
    "/units/{unitId}": { "schema": { "$ref": "#/entities/Unit" } },
    "/projects/{projectId}/zones/{zoneId}": { "schema": { "$ref": "#/entities/Zone" } },
    "/projects/{projectId}/activities/{activityId}": { "schema": { "$ref": "#/entities/Activity" } },
    "/projects/{projectId}/activities/{activityId}/subactivities/{subActivityId}": { "schema": { "$ref": "#/entities/SubActivity" } },
    "/projects/{projectId}/activities/{activityId}/subactivities/{subActivityId}/zoneQuantities/{zoneId}": { "schema": { "$ref": "#/entities/SubActivityZoneQuantity" } },
    "/projects/{projectId}/progress_reports/{reportId}": { "schema": { "$ref": "#/entities/ProgressReport" } },
    "/projects/{projectId}/daily_reports/{reportId}": { "schema": { "$ref": "#/entities/DailyReport" } },
    "/projects/{projectId}/daily_reports/{reportId}/items/{itemId}": { "schema": { "$ref": "#/entities/ReportItem" } },
    "/documents/{documentId}": { "schema": { "$ref": "#/entities/Document" } },
    "/report_index/{reportId}": { "schema": { "$ref": "#/entities/ReportIndex" } },
    "/admin_data/summary": { "schema": { "$ref": "#/entities/AdminDashboardSummary" } },
    "/companies/{companyId}/dashboards/summary": { "schema": { "$ref": "#/entities/CompanyDashboardSummary" } }
  }
}
