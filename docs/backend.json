{
  "entities": {
    "UserProfile": {
      "title": "User Profile",
      "description": "Represents the profile data for a user.",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "role": {
          "type": "string",
          "description": "The user's role in the application (e.g., 'Admin', 'Manager')."
        },
        "project": {
          "type": [
            "string",
            "null"
          ],
          "description": "The ID of the project the user is assigned to. Can be null if unassigned."
        }
      },
      "required": [
        "name",
        "email",
        "role"
      ]
    },
    "Company": {
      "title": "Company",
      "description": "Represents a company or organization.",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the company."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the company."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The contact email for the company."
        },
        "mobile": {
          "type": "string",
          "description": "The contact mobile number for the company."
        },
        "contactPerson": {
          "type": "string",
          "description": "The primary contact person for the company."
        },
        "address": {
          "type": "string",
          "description": "The physical address of the company."
        },
        "archived": {
          "type": "boolean",
          "description": "Whether the company is archived."
        }
      },
      "required": [
        "name",
        "archived"
      ]
    },
    "ConstructionActivity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ConstructionActivity",
      "type": "object",
      "description": "Represents a specific construction activity or task within a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the construction activity."
        },
        "name": {
          "type": "string",
          "description": "Name or title of the construction activity."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the activity."
        },
        "startDate": {
          "type": "string",
          "description": "Planned or actual start date of the activity.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Planned or actual end date of the activity.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the activity (e.g., 'Not Started', 'In Progress', 'Completed')."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "startDate",
        "endDate",
        "status"
      ]
    },
    "ProgressLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProgressLog",
      "type": "object",
      "description": "Represents a log entry documenting the progress of a construction activity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the progress log entry."
        },
        "activityId": {
          "type": "string",
          "description": "Reference to ConstructionActivity. (Relationship: ConstructionActivity 1:N ProgressLog)"
        },
        "logDate": {
          "type": "string",
          "description": "Date and time when the progress was logged.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Textual description of the progress made."
        },
        "imageUrls": {
          "type": "array",
          "description": "References to images associated with progress log.",
          "items": {
            "type": "string"
          }
        },
        "progressPercentage": {
          "type": "number",
          "description": "Percentage of the activity that has been completed."
        }
      },
      "required": [
        "id",
        "activityId",
        "logDate",
        "description",
        "progressPercentage"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a generated progress report for stakeholders.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the report."
        },
        "title": {
          "type": "string",
          "description": "Title of the report."
        },
        "generationDate": {
          "type": "string",
          "description": "Date and time when the report was generated.",
          "format": "date-time"
        },
        "activityIds": {
          "type": "array",
          "description": "References to Construction Activities included in the report.",
          "items": {
            "type": "string"
          }
        },
        "content": {
          "type": "string",
          "description": "The full content of the generated report."
        }
      },
      "required": [
        "id",
        "title",
        "generationDate",
        "activityIds",
        "content"
      ]
    },
    "EquipmentType": {
      "title": "Equipment Type",
      "description": "Represents a type of construction equipment.",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the equipment type (e.g., 'JCB', 'Bobcat')."
        }
      },
      "required": [
        "name"
      ]
    },
    "Equipment": {
      "title": "Equipment",
      "description": "Represents a single piece of construction equipment.",
      "type": "object",
      "properties": {
        "plateNumber": {
          "type": "string",
          "description": "The unique plate number or identifier for the equipment."
        },
        "typeId": {
          "type": "string",
          "description": "A reference to the ID in the 'equipment_names' collection."
        },
        "status": {
          "type": "string",
          "description": "The current operational status of the equipment.",
          "enum": [
            "Working",
            "Broken",
            "In Garage"
          ]
        },
        "assignedTo": {
          "type": "string",
          "description": "The ID of the user this equipment is assigned to."
        },
        "projectId": {
          "type": "string",
          "description": "The ID of the project this equipment is currently working on."
        },
        "thirdPartyCertificateDate": {
          "type": "string",
          "format": "date-time",
          "description": "The expiry date of the third-party certification."
        },
        "ownershipCertificateDate": {
          "type": "string",
          "format": "date-time",
          "description": "The expiry date of the ownership certification."
        }
      },
      "required": [
        "plateNumber",
        "typeId",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores public-facing profile information for a user, such as name and role.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/companies/{companyId}",
        "definition": {
          "entityName": "Company",
          "schema": {
            "$ref": "#/backend/entities/Company"
          },
          "description": "Stores companies in a global collection.",
          "params": [
            {
              "name": "companyId",
              "description": "The unique identifier of the company."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/constructionActivities/{activityId}",
        "definition": {
          "entityName": "ConstructionActivity",
          "schema": {
            "$ref": "#/backend/entities/ConstructionActivity"
          },
          "description": "Stores construction activities owned by a specific user. Path-based ownership ensures only the user can access these activities.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "activityId",
              "description": "The unique identifier of the construction activity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/constructionActivities/{activityId}/progressLogs/{logId}",
        "definition": {
          "entityName": "ProgressLog",
          "schema": {
            "$ref": "#/backend/entities/ProgressLog"
          },
          "description": "Stores progress logs associated with a specific construction activity owned by the user. Continues the ownership hierarchy for secure access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "activityId",
              "description": "The unique identifier of the construction activity."
            },
            {
              "name": "logId",
              "description": "The unique identifier of the progress log entry."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Stores reports generated by users.  A 'members' map inside the report document can manage collaborative access (if needed).",
          "params": [
            {
              "name": "reportId",
              "description": "The unique identifier of the report."
            }
          ]
        }
      },
      {
        "path": "/equipment_names/{equipmentTypeId}",
        "definition": {
          "entityName": "EquipmentType",
          "schema": {
            "$ref": "#/backend/entities/EquipmentType"
          },
          "description": "Stores the list of available equipment types, accessible globally.",
          "params": [
            {
              "name": "equipmentTypeId",
              "description": "The unique identifier for the equipment type."
            }
          ]
        }
      },
      {
        "path": "/equipment/{equipmentId}",
        "definition": {
          "entityName": "Equipment",
          "schema": {
            "$ref": "#/backend/entities/Equipment"
          },
          "description": "Denormalized collection for fast equipment listing and filtering across the entire organization.",
          "params": [
            {
              "name": "equipmentId",
              "description": "The unique identifier for the piece of equipment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a clear, secure, and scalable solution for the Site Tracker application, focusing on progress tracking for construction activities. Authorization Independence is achieved via path-based ownership for `ConstructionActivity` and `ProgressLog`, ensuring that access control is directly tied to the user and the resource, eliminating the need for `get()` calls in security rules. \n\nSpecifically:\n\n*   `/users/{userId}`: Stores public user profiles. Access is controlled so that users can only modify their own profiles, but other authenticated users might be able to read public information.\n*   `/companies/{companyId}`: Global collection for companies.\n*   `/users/{userId}/constructionActivities/{activityId}`: This path establishes a direct ownership relationship between a user and their construction activities. Only the authenticated user (identified by `{userId}`) has access to the activities within their path.  This supports secure `list` operations as only the current user's activities are accessible at this path.\n*   `/users/{userId}/constructionActivities/{activityId}/progressLogs/{logId}`: This path continues the ownership hierarchy. Each progress log is associated with a specific construction activity owned by the user. This allows efficient and secure retrieval of progress logs related to an activity.\n*   `/reports/{reportId}`: Reports are stored in a top-level collection. Access to reports can be controlled via a `members` map within each report document, enabling collaborative viewing/editing, or restricted to the report creator. Alternatively, reports can be stored under the user's collection to give them full ownership.\n*   `/equipment_names/{equipmentTypeId}`: This is a global collection that all authenticated users can read from, but only admins should be able to write to. It provides a centralized list of equipment types for use throughout the application.\n*   `/equipment/{equipmentId}`: This is a top-level, denormalized collection to allow for efficient querying and listing of all equipment across the organization, regardless of which user, company, or project owns it. Security rules will determine who can read or write to this collection.\n\nThis structure facilitates simple, robust, and easily debuggable security rules, aligning with the core design principles."
  }
}

    